---
- hosts: ansible
  tasks:
    - name: Install Ansible AWX
        apt:
          update_cache: yes
          autoclean: yes

        apt_repository:
          repo: 'ppa:ansible/ansible'

        apt_repository:
          repo: deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable

        apt_key:
          url: https://download.docker.com/linux/ubuntu/gpg
          state: present

        apt:
          name: "{{ item }}"
          update_cache: yes
          autoclean: yes
          state: present
        with_items:
          - 'ansible'
          - 'docker-ce'
          - 'make'
          - 'git'
          - 'python-setuptools'
          - 'python-pip'
          - 'python3-pip'

        pip:
          name: "{{ item }}"
        with_items:
          - 'pip'
          - 'docker'

        pip:
          name: "{{ item }}"
          executable: pip3
        with_items:
          - 'pip'
          - 'docker'

        git:
          repo: https://github.com/ansible/awx.git
          dest: /root/awx
          clone: yes
          update: yes

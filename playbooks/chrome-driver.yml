---
- hosts: localhost
  connection: local
  tasks:

    - set_fact:
        version: 101.0.4951.41

    # use Google Chrome Stable to match driver
    - name: Download linux {{ version }}
      unarchive:
        src: https://chromedriver.storage.googleapis.com/{{ version }}/chromedriver_linux64.zip
        dest: /tmp
        remote_src: yes
      when: ansible_facts.distribution == "Linux"

    - name: Download mac m1 {{ version }}
      unarchive:
        src: https://chromedriver.storage.googleapis.com/{{ version }}/chromedriver_mac64_m1.zip
        dest: /tmp
        remote_src: yes
      when: ansible_facts.distribution == "MacOSX" and ansible_facts.processor == "Apple M1"

    - name: Download mac m1 {{ version }}
      unarchive:
        src: https://chromedriver.storage.googleapis.com/{{ version }}/chromedriver_mac64_m1.zip
        dest: /tmp
        remote_src: yes
      when: ansible_facts.distribution == "MacOSX" and ansible_facts.processor != "Apple M1"

    - name: Download windows {{ version }}
      unarchive:
        src: https://chromedriver.storage.googleapis.com/{{ version }}/chromedriver_win32.zip
        dest: /tmp
        remote_src: yes
      when: ansible_facts.distribution == "Windows"

    - name: Install chromedriver {{ version }}
      copy:
        src: /tmp/chromedriver
        dest: /usr/local/bin/chromedriver
        remote_src: yes
        mode: 0755
      become: yes

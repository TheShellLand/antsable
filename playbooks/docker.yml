---
- hosts: all
  tasks:

  - name: apt-transport-https
    apt: update_cache=yes name=apt-transport-https state=latest
    retries: 99
    delay: 3
    register: result
    until: result is succeeded

  - name: ca-certificates
    apt: update_cache=yes name=ca-certificates state=latest
    retries: 99
    delay: 3
    register: result
    until: result is succeeded

  - name: curl
    apt: update_cache=yes name=curl state=latest
    retries: 99
    delay: 3
    register: result
    until: result is succeeded

  - name: software-properties-common
    apt: update_cache=yes name=software-properties-common state=latest
    retries: 99
    delay: 3
    register: result
    until: result is succeeded

  - name: Add docker repository key
    shell: curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add -
    retries: 99
    delay: 3
    register: result
    until: result is succeeded

  - name: Add docker repo
    shell: add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
    retries: 99
    delay: 3
    register: result
    until: result is succeeded

  - name: Install docker-ce
    #apt: update_cache=yes name=docker-ce state=absent
    apt: update_cache=yes name=docker-ce state=latest
    retries: 99
    delay: 3
    register: result
    until: result is succeeded

  - name: Added user to docker group
    shell: usermod -a -G docker vagrant
    ignore_errors: yes

  - name: Added user to docker group
    shell: usermod -a -G docker ubuntu
    ignore_errors: yes

  - name: Added user to docker group
    shell: usermod -a -G docker eric
    ignore_errors: yes


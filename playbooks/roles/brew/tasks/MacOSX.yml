---
- block:
    - name: "{{ BREW }} --version"
      shell: "{{ BREW }} --version"
      register: shell
      changed_when: false

  rescue:

    - name: '{{ ARCH }} /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"'
      shell: '{{ ARCH }} /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"'
      register: shell
      changed_when: "shell.rc != 0"
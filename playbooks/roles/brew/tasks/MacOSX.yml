---
- block:
    - name: check
      shell: which brew
      register: shell
      changed_when: false

  rescue:
    - name: '{{ ARCH }} /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"'
      shell: '{{ ARCH }} /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"'
      register: shell
      changed_when: "shell.rc != 0"
      become: true
      become_user: "{{ ansible_user_id }}"

- debug: var=shell
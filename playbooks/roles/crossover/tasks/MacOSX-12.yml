---
- name: install
  shell: |
    {{ BREW_M1 }} install --cask {{ package }}
  register: shell
  changed_when: "'installed' not in shell.stderr"

- name: upgrade
  shell: |
    {{ BREW_M1 }} upgrade --cask {{ package }}
  register: shell
  failed_when: shell.stdout
  changed_when: shell.stdout
  when: "'installed' in shell.stderr"

# ~/Library/Preferences/com.codeweavers.CrossOver.plist
- name: reset trial by deleting plist?
  file:
    path: ~/Library/Preferences/com.codeweavers.CrossOver.plist
    state: absent

- include_tasks: source-mac.yml
  when: FROM_SOURCE
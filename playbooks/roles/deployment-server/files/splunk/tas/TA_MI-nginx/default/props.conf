[nginx:plus:kv]
KV_MODE = auto
SHOULD_LINEMERGE=false
NO_BINARY_CHECK=true
CHARSET=UTF-8
TIME_PREFIX = time_local
pulldown_type=true
description = NGINX access log in key-value pair format
category = Web

#FIELDALIAS-nginx_src = client_address as src
#FIELDALIAS-nginx_dest-ip = dest as dest_ip
#FIELDALIAS-nginx_port = port as dest_port
#FIELDALIAS-nginx_user = remote_user as user
FIELDALIAS-nginx_http_referrer = http_referer as http_referrer
FIELDALIAS-nginx_version = nginx_version as version

EVAL-action = "allowed"
EVAL-dest = COALESCE(server,dest_ip)
EVAL-app = "Nginx Plus"
EVAL-bytes = if(isnum(bytes_in),bytes_in,0) + if(isnum(bytes_out),bytes_out,0)
EVAL-http_user_agent_length = len(http_user_agent)
EVAL-web_server = host . ":" . site
EVAL-product                                    = "Web Server"
EVAL-vendor                                     = "Nginx Plus"
EVAL-vendor_product                     = "Nginx Plus Web Server"

# need this for when nginx is configured as a proxy
LOOKUP-vendor_traffic_action = nginx_proxy_action_lookup vendor_action OUTPUT action, transport

###
# We need this data source for performance metrics planned for web server ITSI model
###
[nginx:plus:api]
SHOULD_LINEMERGE = false
KV_MODE = JSON
TIME_PREFIX = \"timestamp\"\:
pulldown_type = true
description = NGINX performance metrics
category = Web


FIELDALIAS-ip = address as ip

FIELDALIAS-status = upstreams.splunk_enterprise.peers{}.state as status
EVAL-app = "Nginx Plus"
#response time response_time 
# The average time to get the full response from the server (1.7.10). The field is available when using the least_time load balancing method.
EVAL-web_server = host . ":" . "status"
EVAL-product 					= "Web Server"
EVAL-vendor 					= "Nginx Plus"
EVAL-vendor_product 			= "Nginx Plus Web Server"


###
# Get as much data as we can from default log format (W3C)
###
[nginx:plus:access]
KV_MODE = none
SHOULD_LINEMERGE=false
NO_BINARY_CHECK=true
CHARSET=UTF-8
TIME_PREFIX=\[
disabled=false
maxDist=28
pulldown_type=true
description = NGINX default access log
category = Web


REPORT-nginx-log-extract = nginx_main_extract
REPORT-nginx_uri_bits = nginx_plus_access_uri_info

FIELDALIAS-nginx_http_method = request_method as http_method
FIELDALIAS-nginx_http_referrer = http_referer as http_referrer
FIELDALIAS-nginx_response_code = response_code as status
FIELDALIAS-nginx_site = ident as site
FIELDALIAS-nginx_src = src_ip as src

EVAL-app = "Nginx Plus"
EVAL-http_user_agent_length = len(http_user_agent)

EVAL-product 					= "Web Server"
EVAL-vendor 					= "Nginx Plus"
EVAL-vendor_product 			= "Nginx Plus Web Server"
EVAL-web_server = host . ":" . ident


[nginx:plus:error]
NO_BINARY_CHECK = true
category = Web
description = Error logs produced by Nginx Plus Web Server
pulldown_type = true
SHOULD_LINEMERGE = false

EVAL-product 					= "Web Server"
EVAL-vendor 					= "Nginx Plus"
EVAL-vendor_product 			= "Nginx Plus Web Server"





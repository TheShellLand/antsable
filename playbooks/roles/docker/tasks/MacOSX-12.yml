---
#- name: install
#  shell: |
#    {{ BREW_M1 }} install --cask {{ package }}
#  register: shell
#  changed_when: "'installed' not in shell.stderr"
#
#- name: upgrade
#  shell: |
#    {{ BREW_M1 }} upgrade --cask {{ package }}
#  register: shell
#  failed_when: shell.stdout
#  changed_when: shell.stdout
#  when: "'installed' in shell.stderr"

- get_url:
    url: https://desktop.docker.com/mac/main/arm64/Docker.dmg
    dest: ./docker.dmg

- shell: |
    url=docker.dmg

    folder=Docker
    app="Docker.app"

    hdiutil attach -nobrowse "$url"
    volume="/Volumes/$folder"
    cp -R "$volume/$app" /Applications/ && echo OK
    hdiutil detach "$volume"
  register: shell
  become: yes
  changed_when: "'OK' not in shell.stdout"
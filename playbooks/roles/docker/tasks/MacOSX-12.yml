---
- name: install
  shell: |
    {{ BREW_M1 }} install --cask {{ package }}
  register: shell
  changed_when: "'installed' not in shell.stderr"

- name: upgrade
  shell: |
    {{ BREW_M1 }} upgrade --cask {{ package }}
  register: shell
  failed_when: shell.stdout
  changed_when: shell.stdout
  when: "'installed' in shell.stderr"



#- name: docker
#  shell: |
#    folder="Docker"
#    app="docker.app"
#    volume="/Volumes/$folder"
#    url=https://desktop.docker.com/mac/stable/Docker.dmg
#
#    hdiutil attach -nobrowse "$url"
#    cp -R "$volume/$app" /Applications/
#    hdiutil detach "$volume"
#  become: yes

#- name: docker download
#  get_url:
#    url: https://desktop.docker.com/mac/main/arm64/Docker.dmg
#    dest: ./Docker.dmg

#- name: docker install
#  shell: |
#    url=Docker.dmg
#
#    folder="Docker"
#    app="Docker.app"
#
#    hdiutil attach -nobrowse "$url"
#    volume="/Volumes/$folder"
#    cp -R "$volume/$app" /Applications/
#    hdiutil detach "$volume"
#  become: yes

# You must install Rosetta 2 as some binaries are still Darwin/AMD64.
# To install Rosetta 2 manually from the command line, use this command:
#- name: docker Apple Silicon Tech Preview - fix
#  shell: echo "A" | softwareupdate --install-rosetta
#  become: yes

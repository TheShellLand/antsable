---
- name: deb
  block:
    - block:
        - shell: "ls /Applications/ | grep -i '{{ mac_app }}'"
          register: shell
          changed_when: false

    - block:
        - name: deb
          get_url:
            url: "{{ url }}"
            dest: "./{{ mac_deb }}"
          when: url

        - shell: |
            url={{ mac_deb }}
            
            folder="{{ mac_folder }}"
            app="{{ mac_app }}"
            
            hdiutil attach -nobrowse "$url"
            volume="/Volumes/$folder"
            cp -R "$volume/$app" /Applications/ && echo OK
            hdiutil detach "$volume"
          register: shell
          become: yes
          changed_when: "'OK' not in shell.stdout"
      when: not shell.rc == 0
  when: mac_deb

- name: pkg
  block:
    - name: pkg
      get_url:
        url: "{{ url }}"
        dest: "./{{ mac_pkg }}"
      when: url

    - shell: |
        pkg={{ mac_pkg }}
        installer -pkg "$pkg" -target / && echo OK
      register: shell
      become: yes
      changed_when: "'OK' not in shell.stdout"

  when: mac_pkg

- name: zip
  block:
    - name: zip
      get_url:
        url: "{{ url }}"
        dest: "./{{ mac_zip }}"
      when: url

    - debug: msg="Not Implemented"
    - fail:

  when: mac_zip
---
- shell: "ls /Applications/ | grep -i '{{ mac_app }}'"
  register: shell
  changed_when: false

- block:
  - get_url:
      url: "{{ url }}"
      dest: "{{ mac_url }}"

  - shell: |
      url={{ mac_url }}
  
      folder="{{ mac_folder }}"
      app="{{ mac_app }}"
  
      hdiutil attach -nobrowse "$url"
      volume="/Volumes/$folder"
      cp -R "$volume/$app" /Applications/ && echo OK
      hdiutil detach "$volume"
    register: shell
    become: yes
    changed_when: "'OK' not in shell.stdout"
  when: not shell.rc == 0
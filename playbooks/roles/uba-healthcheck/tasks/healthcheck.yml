---
- name: create directory
  file:
    path: /home/caspida/bin
    state: directory
    owner: caspida
  become: yes

- name: copy scripts
  copy:
    src: "files/{{ item }}"
    dest: "/home/caspida/bin/{{ item }}"
    owner: caspida
    mode: "0777"
  become: yes
  become_user: caspida
  loop:
    - uba_health_check-dev.sh
    - uba_health_check.sh
    - uba_pre_check.sh

- name: run healthcheck
  shell: "{{ item }}"
  become: yes
  become_user: caspida
  loop:
    - "/bin/bash /home/caspida/bin/uba_health_check-dev.sh"

- name: get healthcheck file
  fetch:
    src: "{{ item }}"
    dest: "uba_health_check"
  loop:
#    - /var/log/caspida/check/uba_health_check.txt
    - /var/log/caspida/check/uba_health_check-dev.txt

- name: archive file
  archive:
#    path: /var/log/caspida/check/uba_health_check.txt
#    dest: "{{inventory_hostname}}-uba_health_check.tgz"
    path: /var/log/caspida/check/uba_health_check-dev.txt
    dest: "{{inventory_hostname}}-uba_health_check-dev.tgz"

- name: get archive
  fetch:
    src: "{{inventory_hostname}}-uba_health_check-dev.tgz"
    dest: "uba_health_check"

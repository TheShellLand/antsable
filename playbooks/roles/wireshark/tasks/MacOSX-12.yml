---
- name: install
  shell: |
    {{ BREW_M1 }} install --cask wireshark
  register: shell
  changed_when: "'installed' not in shell.stderr"

- name: upgrade
  shell: |
    {{ BREW_M1 }} upgrade --cask wireshark
  register: shell
  failed_when: "'already' not in shell.stderr"
  changed_when: "'already' not in shell.stderr"
  when: "'installed' in shell.stderr"